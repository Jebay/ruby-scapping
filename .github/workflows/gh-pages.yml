name: Publish Gallery
on:
  push:
    branches: ["main"]
permissions:
  contents: read
  pages: write
jobs:
  deploy:
    name: Publish website to Github Pages
    runs-on: ubuntu-latest
    environment:
      name: gh-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@ac593985615ec2ede58e132d2e21d2b1cbd6127c
        with:
          persist-credentials: false

      - name: Setup Pages ⚙️
        uses: actions/configure-pages@37538b280cbfab35da9dcd936a2b95f1f522d927

      - name: Setup Ruby 💎
        uses: ruby/setup-ruby@v1
        with:
          bundler-cache: true

      - name: Generate HTML file 🌐
        run: |
          bundle exec rake web_scraper
          mkdir build_output && mv *.html build_output

      - name: Package and upload artifact 📦
        uses: actions/upload-pages-artifact@253fd476ed429e83b7aae64a92a75b4ceb1a17cf
        with:
          path: build_output

      - name: Deploy to Github Pages 🚀
        uses: actions/deploy-pages@0243b6c10d06cb8e95ed8ee471231877621202c0
