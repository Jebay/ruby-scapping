name: Publish Gallery
on:
  push:
    branches: ["main"]
  schedule:
    - cron: '0 9 * * *'
permissions:
  contents: read
  pages: write
  id-token: write
jobs:
  deploy:
    name: Publish website to Github Pages
    runs-on: ubuntu-latest
    environment:
      name: gh-pages
      url: ${{ steps.deploy.outputs.page_url }}
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@ac593985615ec2ede58e132d2e21d2b1cbd6127c
        with:
          persist-credentials: false

      - name: Setup Pages ⚙️
        uses: actions/configure-pages@fc89b04e7d263ef510d9e77d3a1d088fb2688522

      - name: Setup Ruby 💎
        uses: ruby/setup-ruby@31a7f6d628878b80bc63375a93ae079ec50a1601
        with:
          bundler-cache: true

      - name: Generate HTML file 🌐
        run: |
          bundle exec rake web_scraper
          mkdir build_output && mv *.html build_output

      - name: Package and upload artifact 📦
        uses: actions/upload-pages-artifact@253fd476ed429e83b7aae64a92a75b4ceb1a17cf
        with:
          path: 'build_output'
          name: gh-pages

      - name: Deploy to Github Pages 🚀
        id: deployment
        uses: actions/deploy-pages@0243b6c10d06cb8e95ed8ee471231877621202c0
        with:
          artifact_name: gh-pages

      - name: Delete artifact 🗑️
        uses: geekyeggo/delete-artifact@v2
        with:
          name: gh-pages
